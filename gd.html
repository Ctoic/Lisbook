<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Favorite Books Music App</title>
    <link rel="icon" href="Images/favicon.jpg" type="image/png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>

  <body class="bg-gray-900 text-gray-300 min-h-screen flex flex-col">
    <!-- Theme Initialization -->
    <script>
      (function () {
        try {
          const saved = localStorage.getItem("theme");
          const theme =
            saved === "light"
              ? "light"
              : saved === "dark"
              ? "dark"
              : null;
          if (theme) {
            document.documentElement.setAttribute("data-theme", theme);
            document.body.classList.remove("light-theme", "dark-theme");
            document.body.classList.add(theme + "-theme");
          }
        } catch (e) {
          console.warn("theme init error", e);
        }
      })();
    </script>

    <!-- MAIN CONTENT -->
    <main class="flex flex-col items-center px-4 py-8 flex-grow">
      <section
        class="flex flex-col md:flex-row gap-8 w-full max-w-6xl rounded-3xl bg-gray-800 p-6 md:p-10 shadow-lg"
      >
        <!-- LEFT: Book Details -->
        <div
          class="w-full md:w-1/3 flex flex-col items-center text-center bg-gray-900 rounded-2xl p-6 border border-gray-700"
        >
          <!-- Book Cover -->
          <div
            class="flex items-center justify-center rounded-xl overflow-hidden border border-gray-700 bg-gray-800 w-full h-72 sm:h-80"
          >
            <img
              id="img"
              src="./Images/GD.jpeg"
              alt="God Delusion Cover"
              class="object-contain w-full h-full"
            />
          </div>

          <!-- Book Info -->
          <div class="mt-6">
            <h1
              class="text-2xl font-bold text-green-400"
              data-translate="title"
            >
              God Delusion
            </h1>
            <h3 class="text-lg mt-1" data-translate="author">
              By Richard Dawkins
            </h3>
            <p class="text-sm mt-3 leading-relaxed" data-translate="description">
              The God Delusion is a book by English biologist Richard Dawkins
              that argues against the existence of a supernatural creator.
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="flex justify-center gap-6 mt-6 text-2xl">
            <i
              class="bi bi-heart hover:text-green-400 cursor-pointer transition"
              id="favourite-btn"
              title="Save to Favourites"
            ></i>
            <i
              class="bi bi-share hover:text-green-400 cursor-pointer transition"
              id="share-btn"
              title="Share"
            ></i>
            <i
              class="bi bi-chat hover:text-green-400 cursor-pointer transition"
              id="view-comments-btn"
              title="View Comments"
            ></i>
          </div>
        </div>

        <!-- RIGHT: Playlist & Player -->
        <div
          class="w-full md:w-2/3 bg-gray-900 rounded-2xl border border-gray-700 p-6 flex flex-col"
        >
          <!-- Playlist -->
          <ul
            id="playlist"
            class="space-y-4 overflow-y-auto max-h-[55vh] md:max-h-[60vh] pr-2"
          >
            <!-- Example Track -->
            <li
              class="flex flex-col gap-2 bg-gray-800 p-3 rounded-xl"
              data-src="audio/part1.mp3"
            >
              <div class="flex justify-between items-center">
                <p data-translate="t0">Introduction: God Delusion</p>
                <a href="audio/part1.mp3" download
                  ><i class="bi bi-cloud-arrow-down-fill text-lg"></i
                ></a>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-2">
                <div
                  class="bg-green-400 h-2 rounded-full w-0 progress-bar"
                ></div>
              </div>
            </li>

            <!-- You can repeat similar <li> blocks for additional tracks -->
          </ul>

          <!-- Audio Player -->
          <div
            class="mt-6 bg-gray-800 p-4 rounded-2xl flex flex-col items-center"
          >
            <audio id="audio-player" class="w-full mt-2"></audio>

            <!-- Seek Slider -->
            <div class="flex items-center w-full gap-2 mt-2">
              <span id="currentTime" class="text-xs">0:00</span>
              <input
                type="range"
                id="seekSlider"
                min="0"
                value="0"
                class="flex-grow accent-green-400"
              />
              <span id="duration" class="text-xs">0:00</span>
            </div>

            <!-- Speed Control -->
            <div class="relative mt-3">
              <span
                id="speedButton"
                class="cursor-pointer text-green-300 font-semibold rounded-lg py-1 px-3 hover:text-green-200 transition"
                >1x</span
              >
              <ul
                id="speedDropdown"
                class="absolute hidden bg-gray-900 border border-gray-700 rounded-xl mt-2 w-20 shadow-lg"
              >
                <li
                  class="px-4 py-2 cursor-pointer hover:bg-gray-700 rounded-xl text-green-300"
                  data-speed="0.5"
                >
                  0.5x
                </li>
                <li
                  class="px-4 py-2 cursor-pointer hover:bg-gray-700 rounded-xl text-green-300"
                  data-speed="1"
                >
                  1x
                </li>
                <li
                  class="px-4 py-2 cursor-pointer hover:bg-gray-700 rounded-xl text-green-300"
                  data-speed="1.5"
                >
                  1.5x
                </li>
                <li
                  class="px-4 py-2 cursor-pointer hover:bg-gray-700 rounded-xl text-green-300"
                  data-speed="2"
                >
                  2x
                </li>
              </ul>
            </div>

            <!-- Control Buttons -->
            <div
              id="ctrl-player"
              class="flex flex-wrap justify-center gap-6 mt-4 text-green-300 text-xl"
            >
              <div
                id="volume-down"
                class="cursor-pointer hover:text-green-400 transition"
              >
                <i class="bi bi-volume-down-fill"></i>
              </div>
              <div
                id="fast-backward"
                class="cursor-pointer hover:text-green-400 transition"
              >
                <span>-30</span>
              </div>
              <div
                id="ctrl-play"
                class="cursor-pointer hover:text-green-400 transition text-3xl"
              >
                <i class="bi bi-play-fill"></i>
              </div>
              <div
                id="fast-forward"
                class="cursor-pointer hover:text-green-400 transition"
              >
                <span>+30</span>
              </div>
              <div
                id="volume-up"
                class="cursor-pointer hover:text-green-400 transition"
              >
                <i class="bi bi-volume-up-fill"></i>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- JS Scripts -->
    <script src="./script.js"></script>
    <script src="./translation.js"></script>

    <script>
      function changeLanguage(language) {
        applyTranslations(language);
      }

      if (window.location !== window.parent.location) {
        document.body.classList.add("embedded");
      }

      window.addEventListener("message", (event) => {
        try {
          const data = event.data || {};
          if (data.type === "changeLanguage") {
            applyTranslations(data.language);
          }
          if (data.type === "theme") {
            const theme = data.theme;
            document.documentElement.setAttribute("data-theme", theme);
            document.body.classList.remove("light-theme", "dark-theme");
            document.body.classList.add(theme + "-theme");
          }
        } catch (err) {
          console.warn("postMessage handler error", err);
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const defaultLanguage = "en";
        applyTranslations(defaultLanguage);
      });
    </script>
  </body>
</html>
